---
title: "IntroducciÃ³n al software estadÃ­stico R (con Starwars âš”)"
subtitle: "FormaciÃ³n ASEPELT. Universidad de Granada"
author:   
  - name: Gema FernÃ¡ndez-AvilÃ©s 
    email: gema.faviles@uclm.es
# date: "`r Sys.Date()`"
format:
  html:
    theme: cerulean
    highlight-style: ayu-mirage
    self-contained: true
    lang: es
    date-format: long
    embed-resources: true
    toc-title: Summary
    toc: true
    number-sections: true
    preview-links: auto
    code-link: true
number-sections: true
execute:
  echo: true
  eval: true
  output: true
  include: true
  freeze: auto
  fig-height: 5
  warning: false
  comment: "#>"
  code-line-numbers: true
  code-copy: true
  code-overflow: scroll
---



::: {.callout-warning}
## IMPORTANTE

ðŸ“• **Como buen estudiante que eres, sabrÃ¡s lo importante que es trabajar de forma autÃ³noma y venir a clase con el material leÃ­do ðŸ˜Š**. 

ðŸ¦„ <mark> Este icono indica **AVANZADO E IMPORTANTE**</mark>

:::



# ðŸ›  Toolkit del curso: R, RStudio y Quarto

El objetivo de esta unidad es presentar **R**, **RStudio** y **Quarto**, herramientas imprescindibles, que utilizarÃ¡ a lo largo del curso.


## Prerrequisitos  

Se asume que has revisado las Unidad 1 "Toolkit del curso: R, RStudio y Quarto" y que tienes instalado y funcionando todo lo propuesto en la Unidad O "Calentando motores".

## TerminologÃ­a

Ya hemos utilizado algunos tÃ©rminos nuevos, asÃ­ que vamos a definirlos antes de continuar.

- **R:** Nombre del lenguaje de programaciÃ³n que utilizaremos a lo largo del curso.

- **RStudio:** Entorno de desarrollo integrado para R.
    En otras palabras, una interfaz conveniente para escribir y ejecutar cÃ³digo R.

- **Quarto:** Sistema de publicaciÃ³n cientÃ­fica y tÃ©cnica de cÃ³digo abierto basado en Pandoc.
Crea y publique artÃ­culos, informes, presentaciones, sitios web, blogs y libros de alta calidad en HTML, PDF, MS Word, ePub, etc., incluyendo ecuaciones, citas, referencias cruzadas, paneles de figuras, llamadas, diseÃ±o avanzado y mucho mÃ¡s.

- **Proyecto:** Un proyecto es un directorio de trabajo (carpeta) que contiene todo lo necesario para trabajar en un anÃ¡lisis de datos (proyecto) especÃ­fico. Tipos de proyectos: documentos, presentaciones, paquetes, Webs.

- **Paquete:** Un paquete es una colecciÃ³n de funciones, datos y documentaciÃ³n que extiende las capacidades de **R**. Ejemplo: `tydiverse`, `ggplot2`, `dplyr`.

- **FunciÃ³n:** Una funciÃ³n es un bloque de cÃ³digo que realiza una tarea especÃ­fica. Las funciones toman argumentos, realizan alguna tarea y devuelven un resultado. Ejemplo: `mean()`, `ggplot()`, `filter()`.

- **Chunk:** Un chunk es un bloque de cÃ³digo **R** que se ejecuta en un documento, Quarto en nuestro caso.  


## Empezar despacio

A medida que avanza el curso, se anima al estudiante a explorar mÃ¡s allÃ¡ de lo que dictan las clases.
Sin embargo, antes de llegar a esa etapa, se necesita adquirir cierta fluidez bÃ¡sica en **R**.
En primer lugar, comprobemos que el proyecto que hemos creado funciona perfectamente. En el debemos trabajar todo el curso.

`File > New Project > New Directory > Quarto Project > Poner nombre y seleccionar directorio`

Estructura de carpetas dentro del proyecto:

* ðŸ“‚ `data`

* ðŸ“‚ `img`

::: {.callout-note}
## Quarto

Recuerda que en la **Unidad 1** del curso tienes todo lo necesario para realizar la Tarea 1. 

Una guÃ­a detallada sobre Quarto en RStudio estÃ¡ disponible en el siguiente enlace: <https://quarto.org/docs/get-started/hello/rstudio.html>

:::


# ðŸš‘ La importancia del contexto

::: {.callout-warning title="Tu turno"}
## Tu turno
Completa las partes del cÃ³digo seÃ±aladas por `_____` o `xxxxx` para obtener el resultado deseado y acuÃ©rdate de cambiar `eval: false` por `eval: true` cuando lo hayas cumplimentado para que se ejecute correctamente la chunk.
:::

## Manos a la obra 

::: {.callout-note}
## R: nuestro contexto

Nosotros vamos a contar historias con los datos usando el software 
estadÃ­stico **R** por lo que es necesario conocer algunos paquetes y funciones
para poder manipular y representar los datos.
:::

## Toma toda la ayuda que te presten: `dplyr :: Cheatsheet`

<https://rstudio.github.io/cheatsheets/translations/spanish/data-transformation_es.pdf>

- Datos **tidy**: ordenados
- Cada fila es una **observaciÃ³n**
- Cada columna es una **variable**
- **pipes**` x |> f(y)` serÃ¡ `f(x,y)`


## El conjunto de datos `starwars`

![**Fuente: https://datasciencebox.org**](img/starwars-dataset.png){width="50%"}




## Nuestra filosofÃ­a: *learning by doing*


**Paso 1** Cargamos los datos `starwars` contenidos en el paquete `dplyr`.

```{r carga-datos-starwars}
library("dplyr")
starwars
```


**Paso 2** Â¿CuÃ¡ntas columnas (variables) tiene?
```{r sw-ncol}
ncol(starwars)
```

**Paso 3** Â¿CuÃ¡ntas filas (observaciones) tiene?
```{r sw-nrow}
nrow(starwars)
```

**Paso 4** Â¿CuÃ¡l es la dimensiÃ³n del dataset?
```{r sw-dim}
dim(starwars)
```


**Paso 5** Â¿CÃ³mo extraer una **variable** del `data.frame`? 

OpciÃ³n 1: formato tidy
```{r}
#| eval: false
nombre_dataframe |> select(nombre_variable)
```

OpciÃ³n 2: Con el operador `$`

```{r}
#| eval: false
nombre_dataframe$nombre_variable
```

::: {.callout-important title="Tu turno"}
Selecciona la variable `name` del conjunto de datos `starwars`.
:::

```{r}
# Tu cÃ³digo R aquÃ­
```

**Paso 6** Para asignar "algo" (la variable `name`) a "algo" (el objeto `sw_name`) se utiliza el operador `<-`.

```{r sw-variable-name}
sw_name <- starwars$name
```


::: {.callout-note}
## Operador `<-`

El operador `<-` asigna al "sÃ­mbolo" que hay a su izquierda el resultado
de la expresiÃ³n que hay a su derecha. El operador `=` funciona "igual" que `<-`. 
:::



**Paso 7** Â¿Como extraer una observaciÃ³n del conjunto de datos?

```{r sw-obsev}
#| eval: false
nombre_dataframe|>
  filter(nombre_variable == "nombre_observacion")
```

::: {.callout-important title="Tu turno"}
Selecciona una observaciÃ³n (el bueno), `Luke Skywalker`, filtrando por el nombre en la variable `name` del conjunto `starwars`
:::


```{r sw-obsev-luke-skywalker}
# Tu cÃ³digo R aquÃ­
```


**Paso 8** ExploraciÃ³n del dataset `starwars` de un **vistazo** (con la funciÃ³n `skim()` de la librerÃ­a `skimr`):

```{r sw-explora}
skimr::skim(starwars)
```






# ðŸ“Š La elecciÃ³n de un grÃ¡fico efectivo. Â¿CÃ³mo describirÃ­as la relaciÃ³n entre la masa (`mass`) y la altura (`height`) de los personajes de Starwars (`starwars`) mediante una visualizaciÃ³n? 


::: {.callout-warning}
## Â¿CÃ³mo visualizar con la funciÃ³n `ggplot()` del paquete `ggplot2`? Recuerda: 

<mark> **Paso 1** Cargar el paquete `ggplot` con la funciÃ³n `library()`. </mark>

```{r ggplot-library, eval= TRUE}
library(ggplot2)
```


<mark> **Paso 2** Utilizar la funciÃ³n `ggplot()` y la estÃ©tica `aesthetics` ðŸ‘¸. </mark>

```{r aes-col, eval= FALSE }
ggplot(data = nuestro_dataset, 
       mapping = aes(x = x-variable, 
                     y = y-variable,
                     colour = xxxxx,
                     shape = xxxxx,
                     size = xxxxx,
                     alpha = xxxxx)
       ) +
  geom_xxxx() +
   otras opciones
```
:::



**Paso (iii)** Punto de partida

```{r starwars2-10}
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour = gender)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters",
       x = "Height (cm)", 
       y = "Weight (kg)",
       colour = "Gender")  
```




# ðŸ˜” El desorden es tu enemigo

Para evitar el desorden, podemos simplificar la visualizaciÃ³n eliminando elementos innecesarios y enfocÃ¡ndonos en lo esencial. Â¿Son necesarios los `NA` en este caso? Â¿El fondo gris aporta informaciÃ³n?

**Paso 1** Elimino los datos faltantes, NA (Not Avaliable) con la funciÃ³n `is.na()`, indicando que filtre los que son distintos a NA (con el operador `!`). Guardo el nuevo conjunot de datos en el objeto `starwars_clean`.
```{r}
starwars_clean <- starwars |>
  filter(!is.na(gender))
```

**Paso 2** Compruebo que no tengo `NAs` con la funciÃ³n `is.na()`.
```{r}
summary(is.na(starwars_clean))
```

**Paso 3** Cambio el tema del fondo del grÃ¡fico. Prueba algunos y elige el que consideres mÃ¡s apropiado: `theme_bw()`, `theme_minimal()`, `theme_light()`, `theme_dark()`,...


```{r}
#| eval: false
ggplot(data = starwars_clean,
       mapping = aes(x = height, 
                     y = mass, 
                     colour = gender)) +
  geom_point() +
  labs(title = "Mass vs. Height of Starwars Characters",
       x = "Height (cm)", y = "Weight (kg)",
       colour = "Gender") +
  theme_xxx()
```




# ðŸ›‘ Centra la atenciÃ³n de tu audiencia

Para centrar la atenciÃ³n, podemos analizar ciertos puntos de interÃ©s, como los personajes con alturas y pesos extremos.

**Paso 1** Centro la atenciÃ³n en el personaje *outlier* para ver quiÃ©n es. Para ello filtro (`filter()`) los valores de la variable `mass > 1000` e indico que ponga una etiqueta con la variable `label = name` .

```{r}
#| eval: false
ggplot(starwars_clean |> 
         filter(_____ > ____), 
       aes(x = ___, 
           y = ___, 
           label = ____, 
           colour = ____)) +
  geom_point() +
  geom_text(hjust = 1.1, vjust = 1.1, size = 3) +
  labs(title = "Characters with Mass Greater than 1000",
       x = "Height (cm)", 
       y = "Weight (kg)",
       colour = "Gender") +
  theme_bw() 
```


**Paso 2** Determinamos el conjunto de datos objetivo. En este caso, eliminamos el personaje *outlier*, `Jabba Desilijic Tiure`, del conjunto de datos `starwars_clean` y lo guardamos en el objeto `starwars_clean_sin_outlier`.
```{r}
starwars_clean_sin_outlier <- starwars_clean |>
      filter(name != "Jabba Desilijic Tiure")
```


**Paso 3** Representamos el diagrama de dispersiÃ³n del conjunto de datos `starwars_clean_sin_outlier`.

```{r}
#| eval: true
ggplot(starwars_clean_sin_outlier,
       mapping = aes(x = height, 
                     y = mass, 
                     colour = gender)) +
  geom_point() +
  labs(title = "Mass vs. Height of Starwars Characters (Excluding Jabba)",
       x = "Height (cm)", y = "Weight (kg)",
       colour = "Gender") +
    theme_bw()
```

